# Next.JS Quickstart

Welcome to the Next.js Quickstart guide! In this document, you will learn to build a Next.js app, add user login and display user profile information using {{ product_name }}.

[//] STEPS_START

## Configure an Application in {{ product_name }}

- Sign into {{ product_name }} console and navigate to **Applications > New Application.**
- Select **Traditional Web Application** and complete the wizard popup by providing a suitable name and an authorized redirect URL.(*Ensure that the protocol remains set to OpenID Connect (OIDC).)* 

!!! Example
    **name:** nextjs-react

    **Authorized redirect URL:** http://localhost:3000/api/auth/callback/asgardeo

Note down the following values from the **Protocol** and **Info**  tabs of the registered application. You will need them to configure Asgardeo React SDK.

- **`client-id`** from the **Protocol** tab. 
- **`client-secret`** from the **Protocol** tab. 
- **`issuer`** from the **Info** tab. 

!!! Info

    The authorized redirect URL determines where {{product_name}} should send users after they successfully log in. Typically, this will be the web address where your app is hosted. For this guide, we'll use ` http://localhost:3000/api/auth/callback/asgardeo`, as the authorized redirect URL .

## Create a Next.js app 

Create your new Next.js app.

=== "npm"

    ``` bash
    npx create-next-app@latest --typescript {{ product }}-nextjs

    cd {{ product }}-nextjs

    npm install

    npm run dev
    ```

=== "yarn"

    ``` bash
    yarn create next-app --typescript {{ product }}-nextjs

    cd {{ product }}-nextjs

    yarn install

    yarn dev
    ```

=== "pnpm"

    ``` bash
    pnpm create next-app --typescript {{ product }}-nextjs

    cd {{ product }}-nextjs

    pnpm install

    pnpm run dev
    ```

## Install `@asgardeo/next`

Asgardeo React SDK provides all the components and hooks you need to integrate {{ product_name }} into your app. To get started, simply add the Asgardeo React SDK to the project. Make sure to stop the dev server started in the previous step. 

=== "npm"

    ``` bash
    npm install @asgardeo/next
    ```

=== "yarn"

    ``` bash
    yarn add @asgardeo/next
    ```

=== "pnpm"

    ``` bash
    pnpm add @asgardeo/next
    ```

## Set up environment variables

Add following entries to the  `.env` or `.env.*` file, and make sure to replace the placeholders in the following code with the **`client-id`**, **`client-secret`** and **`organization name`** values you copied in **Step-1** during the application registration in the {{product_name}} console. 

```bash title=".env.local"
ASGARDEO_CLIENT_ID="<your-app-client-id>"
ASGARDEO_CLIENT_SECRET="<your-app-client-secret>"
ASGARDEO_ORGANIZATION="<your-asgardeo-organization-name>"
```

## Add `asgardeoMiddleware()` to your app

`asgardeoMiddleware()` is a middleware function that handles authentication and session management for your Next.js application. It integrates with {{product_name}} to provide seamless authentication flows, including login, logout, and session management.

1. Create a `middleware.ts` file.

    - If you're using the `/src` directory, create `middleware.ts` in the `/src` directory.
    - If you're not using the `/src` directory, create `middleware.ts` in the root directory.

2. In your `middleware.ts` file, export the `asgardeoMiddleware()` helper:

```javascript title="middleware.ts"
import { asgardeoMiddleware } from '@asgardeo/nextjs'

export default asgardeoMiddleware()

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    // Always run for API routes
    '/(api|trpc)(.*)',
  ],
}
```

## Add `<AsgardeoProvider />` to your app

The `<AsgardeoProvider />` serves as a context provider for user login in the app. You can add the AsgardeoProvider to your app by wrapping the root component.

```javascript title="app/layout.tsx" hl_lines="2 27 33"
import type { Metadata } from 'next'
import { AsgardeoProvider } from '@asgardeo/next'
import { Geist, Geist_Mono } from 'next/font/google'
import './globals.css'

const geistSans = Geist({
  variable: '--font-geist-sans',
  subsets: ['latin'],
})

const geistMono = Geist_Mono({
  variable: '--font-geist-mono',
  subsets: ['latin'],
})

export const metadata: Metadata = {
  title: 'Asgardeo Next.js Quickstart',
  description: 'Generated by create next app',
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <AsgardeoProvider>
      <html lang="en">
        <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
          {children}
        </body>
      </html>
    </AsgardeoProvider>
  )
}
```

## Add `SignIn` and `SignOut` buttons to your app

To add sign-in and sign-out buttons to your app, you can use the `SignIn` and `SignOut` components provided by the Asgardeo SDK.

```javascript title="app/layout.tsx" hl_lines="31-39"
import type { Metadata } from 'next'
import { AsgardeoProvider, SignedIn, SignedOut, SignIn, SignOut } from '@asgardeo/react'
import { Geist, Geist_Mono } from 'next/font/google'
import './globals.css'

const geistSans = Geist({
  variable: '--font-geist-sans',
  subsets: ['latin'],
})

const geistMono = Geist_Mono({
  variable: '--font-geist-mono',
  subsets: ['latin'],
})

export const metadata: Metadata = {
  title: 'Asgardeo Next.js Quickstart',
  description: 'Generated by create next app',
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <AsgardeoProvider>
      <html lang="en">
        <body className={`${geistSans.variable} ${geistMono.variable} antialiased`}>
          <header>
            <SignedIn>
              <SignOut />
            </SignedIn>
            <SignedOut>
              <SignIn />
            </SignedOut>
            <SignedIn>
              <UserDropdown />
            </SignedIn>
          </header>
          {children}
        </body>
      </html>
    </AsgardeoProvider>
  )
}
```

Visit your app's homepage at [http://localhost:3000](http://localhost:3000).

!!! Important

    You need to create a test user in {{ product_name }} by following this [guide]({{ base_path }}/guides/users/manage-users/#onboard-single-user){:target="_blank"} to tryout login and logout features.

## Optional: Create a dedicated sign-in page instead of using the {{ product_name }}'s default sign-in page

If you would like to create a dedicated sign-in page instead of using the {{ product_name }}'s default sign-in page, you can do so by creating a new page in your Next.js app.

Create a new folder named `sign-in` inside the `app` directory. And inside that, create another folder with the name `[[...sign-in]]`. Then create a new file named `page.tsx` inside.

```javascript title="app/sign-in/[[...sign-in]]/page.tsx"
import { SignIn } from '@asgardeo/next'

export default function Page() {
  return <SignIn />
}
```

Same way you can create a dedicated `SignUp` page in your Next.js app. 

[//] STEPS_END
